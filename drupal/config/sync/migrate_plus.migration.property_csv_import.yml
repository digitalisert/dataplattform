id: property_csv_import
label: Import properties
migration_group: default

source:
  plugin: csv
  path: /opt/drupal/config/sync/data/properties.csv
  delimiter: ','
  enclosure: '"'
  header_offset: 0
  ids:
    - id
  fields:
    0:
      name: id
      label: 'Unique Id'
    1:
      name: name
      label: 'Name'
    2:
      name: type
      label: 'Type'
    3:
      name: value
      label: 'Value'
    4:
      name: propertyresources
      label: 'Resources'

process:
  name: name
  type: type
  value:
    plugin: explode
    source: value
    delimiter: ';'
  value_geofield:
    plugin: explode
    source: value
    delimiter: ';'
  resources:
    -
      plugin: explode
      source: propertyresources
      delimiter: ';'
    -
      plugin: migration_lookup
      migration: propertyresource_csv_import
    -
      plugin: sub_process
      process:
        target_id: '0'
        target_revision_id: '1'

destination:
  plugin: entity_reference_revisions:paragraph

migration_dependencies:
  required:
    - resourceproperty_csv_import
